-- CREATE DATABASE 
CREATE DATABASE ASSIGNMENT8;
USE ASSIGNMENT8;

-- CREATING TABLES
CREATE TABLE COUNTRY
(
COUNTRY_ID INT AUTO_INCREMENT PRIMARY KEY,
COUNTRY_NAME VARCHAR(100),
POPULATION BIGINT,
AREA DECIMAL (10,2));

CREATE TABLE PERSONS
(
ID INT AUTO_INCREMENT PRIMARY KEY,
FNAME VARCHAR (50) NOT NULL,
LNAME VARCHAR(50),
POPULATION BIGINT,
RATING DECIMAL (3,2),
COUNTRY_ID INT,
COUNTRY_NAME VARCHAR(100));

DESC COUNTRY;
DESC PERSONS;

-- INSERTING VALUES INTO TABLE

INSERT INTO COUNTRY
VALUES 
(1, 'USA', '500000', '643801.0'),
(2, 'CANADA', '800000', '683547.4'),
(3, 'AUSTRALIA', '1000000', '45781255.0'),
(4, 'INDIA', '30000000', '3287263.0'),
(5, 'UK', '1500000', '543801.2'),
(6, 'JAPAN', '126300000', '377975.0'),
(7, 'BRAZIL', '211000000', '8515767.0'),
(8, 'MOSCOW', '126300000', '377975.0'),
(9, 'ROME', '60245946', '301340.0'),
(10, 'OTTAWA', '37742154', '9984670.0');

SELECT * FROM COUNTRY;

INSERT INTO PERSONS
VALUES
(DEFAULT, 'JOHN', 'DOE', '500000', '1.0', '1', 'USA'),
(DEFAULT, 'SOPHIA', 'WILLIAMS', '800000', '2.0', '2', 'CANADA'),
(DEFAULT, 'JAMES', 'TAYLOR', '1000000', '3.0', '3', 'AUSTRALIA'),
(DEFAULT, 'AALIYA', 'MILLER', '30000000', '4.0', '4', 'INDIA'),
(DEFAULT, 'EMMA', 'YOUNG', '1500000', '5.0', '5', 'UK'),
(DEFAULT, 'ISABELLA', 'KING', '126300000', '2.0', '6', 'JAPAN'),
(DEFAULT, 'DANIEL', 'HALL', '211000000', '3.0', '7', 'BRAZIL'),
(DEFAULT, 'LILY', 'LEWIS', '126300000', '1.0', '8', 'MOSCOW'),
(DEFAULT, 'MIA', 'NELSON', '60245946', '4.0', '9', 'ROME'),
(DEFAULT, 'MILA', 'MURPHY', '37742154', '5.0', '10', 'OTTAWA');

SELECT * FROM PERSONS;

-- SUBQUERIES

#1. FIND THE NUMBER OF PERSONS IN EACH COUNTRY
SELECT COUNTRY_NAME, 
(SELECT COUNT(*) FROM PERSONS 
WHERE COUNTRY.COUNTRY_NAME = PERSONS. COUNTRY_NAME)
AS NUMBER_OF_PERSONS FROM COUNTRY ORDER BY NUMBER_OF_PERSONS;

#2. FIND THE NUMBER OF PERSONS IN EACH COUNTRY SORTED FROM HIGH TO LOW
SELECT COUNTRY_NAME, 
(SELECT COUNT(*) FROM PERSONS 
WHERE COUNTRY.COUNTRY_NAME = PERSONS. COUNTRY_NAME)
AS NUMBER_OF_PERSONS FROM COUNTRY ORDER BY NUMBER_OF_PERSONS DESC;

#3. FIND OUT AN AVERAGE RATING FOR PERSONS IN RESPECTIVE COUNTRIES IF AVERAGE IS GREATER THAN 3.0
SELECT COUNTRY_NAME,
(SELECT AVG(RATING) FROM PERSONS
WHERE COUNTRY.COUNTRY_NAME = PERSONS. COUNTRY_NAME) 
AS AVERAGE_RATING FROM COUNTRY HAVING AVERAGE_RATING > 3.0;

#4. FIND THE COUNTRIES WITH SAME RATING AS USA USING SUBQUERY
SELECT COUNTRY_NAME FROM PERSONS 
WHERE RATING IN ( SELECT RATING FROM PERSONS WHERE COUNTRY_NAME= 'USA');
 
#5. SELECT ALL COUNTRIES WHOSE POPULATION IS GREATER THAN ATHE AVERAGE POPULATION OF ALL NATIONS.
SELECT COUNTRY_NAME, POPULATION FROM COUNTRY
WHERE POPULATION > (SELECT AVG(POPULATION) FROM COUNTRY);

-- CREATING ANOTHER DATABASE 
-- VIEWS

CREATE DATABASE PRODUCT;
USE PRODUCT;

-- CREATING TABLE
CREATE TABLE CUSTOMER
(
CUSTOMER_ID INT AUTO_INCREMENT PRIMARY KEY,
FIRST_NAME VARCHAR(50) NOT NULL,
LAST_NAME VARCHAR(50),
EMAIL VARCHAR(100),
PHONE_NO VARCHAR(50),
ADDRESS VARCHAR(500),
CITY VARCHAR(50),
STATE VARCHAR(50),
ZIP_CODE VARCHAR (10),
COUNTRY VARCHAR (50)
);

SELECT * FROM CUSTOMER;

-- INSERTING VALUES
INSERT INTO CUSTOMER
VALUES
(DEFAULT, 'JOHN', 'PHILIP', 'JOHNPHILIP@GMAIL.COM', '9548751245', '123 Elm St', 'Springfield', 'CALIFORNIA', '691547', 'USA'),
(DEFAULT, 'JONY', 'MARKOSE', 'JONYMARKOSE@GMAIL.COM', '9548454455', '140 Elm St', 'Springfield', 'TEXAS', '691012', 'USA'),
(DEFAULT, 'ALICE', 'JOHN', 'ALICEJOHN@GMAIL.COM', '9548453355', '177 BLR St', 'MIAMI', 'FLORIDA', '691012', 'UK');


#1. CREATE A VIEW NAMED CUSTOMER_INFO FOR CUSTOMER TABLE THAT DISPLAYS CUSTOMER'S FULL NAME AND EMAIL ADDRESS. THEN PERFORM THE SELECT OPERATIONS FOR CUSTOMER_INFO VIEW

CREATE VIEW CUSTOMER_INFO AS 
SELECT CONCAT(FIRST_NAME, ' ', LAST_NAME) AS FULL_NAME , EMAIL FROM CUSTOMER;

SELECT * FROM CUSTOMER_INFO;

#2. CREATE A VIEW NAMED US_CUSTOMERS THAT DISPLAYS CUSTOMER LOCATED IN THE US

INSERT INTO CUSTOMER
VALUES
(DEFAULT, 'JANE', 'DOE', 'JANEDOE@GMAIL.COM', '8548453355', '125 BLR St', 'MIAMI', 'FLORIDA', '691012', 'US'),
(DEFAULT, 'MICHAEL', 'JOHNSON', 'MICHAELJOHNSON@GMAIL.COM', '4548453355', '177 MNR St', 'SPRINGFIELD', 'TEXAS', '691512', 'US');

CREATE VIEW US_CUSTOMERS AS
SELECT * FROM CUSTOMER WHERE COUNTRY = 'US';

SELECT * FROM US_CUSTOMERS;

#3. CREATE A VIEW NAMED CUSTOMER_DETAILS WITH COLUMNS FULL NAME , EMAIL, PHONE NO, STATE

CREATE VIEW CUSTOMER_DETAILS AS
SELECT CONCAT(FIRST_NAME, ' ',LAST_NAME) AS FULL_NAME, EMAIL, PHONE_NO, STATE FROM CUSTOMER;

SELECT * FROM CUSTOMER_DETAILS;

#4. UPDATE PHONE NO OF CUSTOMER WHO LIVE IN CALIFORNIA FOR CUSTOMER_DETAILS VIEW

UPDATE CUSTOMER 
SET PHONE_NO = '8945127515'
WHERE STATE = 'CALIFORNIA';
SELECT * FROM CUSTOMER_DETAILS;

#5. COUNT THE NO OF CUSTOMERS IN EACH STATE AND SHOW ONLY STATES WITH MORE THAN 5 CUSTOMERS
CREATE VIEW STATE_CUSTOMER_COUNT AS
SELECT STATE,COUNT(*) AS CUSTOMER_COUNT FROM CUSTOMER GROUP BY STATE;

CREATE VIEW STATE_WITH_MORE_THAN_5_CUSTOMER AS
SELECT STATE, CUSTOMER_COUNT FROM STATE_CUSTOMER_COUNT WHERE CUSTOMER_COUNT > 5;

SELECT * FROM STATE_WITH_MORE_THAN_5_CUSTOMER;

#6. WRITE A QUERY THAT WILL RETURN THE NO OF CUSTOMERS IN EACH STATE, BASED ON STATES COLUMN IN THE CUSTOMER_DETAILS VIEW
SELECT STATE, COUNT(*) AS CUSTOMER_COUNT FROM CUSTOMER_DETAILS GROUP BY STATE;

#7. QUERY THAT RETURN ALL THE COLUMNS FROM THE CUSTOMER_DETAILS VIEW, SORT BY STATE COLUMN IN ASCENDING ORDER
SELECT * FROM CUSTOMER_DETAILS ORDER BY STATE ASC;

